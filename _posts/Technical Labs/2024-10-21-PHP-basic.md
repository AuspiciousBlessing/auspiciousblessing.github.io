---
layout: post
title: PHP Basic
description: About the PHP Basic
date: 2024-10-21 12:30:00 +0900
categories: [Technical Labs]
tags: [LAMP, Linux, Apache, MySQL, PHP]
pin: false
math: false
mermaid: false
image:
  path: commons/php-basic.png
  alt: HTTP(Hypertext Transfer Protocol)
---
<!-- categories: [Technical Concepts Summarized, Technical Labs, Technical Terms, Useful Apps To Help With Technology] -->

## Overview
웹개발은 회원가입과 게시판만 만들 수 있으면 마스터했다는 말이 있습니다. 물론 요즘 시대는 기술 발전 속도가 습득속도 보다 현저히 빨라서 평생해도 마스터라는게 없을테지만 말이죠.. 그래도 오늘은 반의 반은 먹고 갈 수 있는 LAMP Stack에서 PHP의 기초인 회원가입을 만들어 보도록 하겠습니다. 

## Features
- 기본적인 기능은 세가지 입니다. 회원 가입, 로그인, 로그아웃
- Database인 MySQL와 연동이 이루어져야 합니다.
- 비밀번호를 암호화하여 저장해야합니다.
- SQL Injection을 막기 위해 최소한의 시큐어 코딩을 해야 합니다.
- 2024년에 걸맞는 디자인이 가미 되어야 합니다.

## Finished Pages
<figure style="text-align: center;">
  <img src="commons/page-signin.png" alt="Device Mockup" style="margin-top: 0px; margin-bottom: 0px;" width="700" />
  <figcaption>Sign in page</figcaption>
</figure>
<figure style="text-align: center;">
  <img src="commons/page-signup.png" alt="Device Mockup" style="margin-top: 0px; margin-bottom: 0px;" width="700" />
  <figcaption>Sign up page</figcaption>
</figure>
<figure style="text-align: center;">
  <img src="commons/page-main.png" alt="Device Mockup" style="margin-top: 0px; margin-bottom: 0px;" width="700" />
  <figcaption>Main page</figcaption>
</figure>

## Used PHP Functions
```php
// MySQLi에서 결과 집합의 행을 연관 배열 형태로 반환하기 위해 사용됩니다.
// 쿼리 결과에서 한 행씩 데이터를 가져오는 역할을 합니다.
function mysqli_fetch_assoc(mysqli_result $result): array|bool|null

// 사용자가 입력한 평문 비밀번호를 해시된 비밀번호와 비교하여 일치하는지 확인합니다.
function password_verify(string $password, string $hash): bool

// 입력된 값에서 특수문자를 이스케이프 처리하여, 데이터베이스 쿼리 실행 시 문제가 발생하지 않도록 만듭니다. 
// 특히, SQL 인젝션 공격을 방지하기 위해 사용됩니다. 
// 예를 들어, 사용자가 악의적으로 쿼리를 조작하기 위한 문자 ('나 -- 같은) 등을 입력했을 때, 
// 이를 문자열로 안전하게 취급하게 만들어 데이터베이스에 해를 끼치지 못하도록 보호합니다.
function mysqli_real_escape_string(mysqli $mysql, string $string): string

// 비밀번호를 데이터베이스에 저장하기 전에 강력한 해시 알고리즘을 사용하여 변환합니다.
// 이를 통해 비밀번호를 안전하게 보호할 수 있으며, 데이터 유출 시에도 사용자의 비밀번호가 쉽게 노출되지 않도록 합니다.
function password_hash(string $password, int|string|null $algo, array $options = []): string

// MySQL 데이터베이스에서 SQL 쿼리를 실행하기 위해 사용되는 함수입니다. 
// PHP에서 MySQL 서버와의 통신을 위해 MySQLi 확장을 사용하여 데이터베이스 작업을 수행합니다.
function mysqli_query(ysqli $mysql, string $query, int $result_mode = MYSQLI_STORE_RESULT): bool|mysqli_result

// 세션을 시작하거나 기존 세션을 재개하는 데 사용됩니다. 
// 사용자가 서버와 상호작용하는 동안 상태를 유지할 수 있도록 도와줍니다.
function session_start(array $options = []): bool

// 현재 세션을 완전히 파괴하는 데 사용됩니다. 
// 모든 세션 데이터를 제거하므로, 사용자가 로그인 상태 등 세션에 저장된 정보를 더 이상 사용할 수 없게 됩니다.
function session_destroy(): bool

// 변수가 설정되었는지(정의되었으며 NULL이 아닌지) 확인하는 데 사용됩니다. 
// 주로 변수가 존재하는지 확인하고 작업을 진행할 때 사용합니다.
function isset($var, ...$vars): bool

// HTTP 헤더를 전송하는 데 사용됩니다. 
// 웹 서버가 브라우저에 응답하기 전에 상태 코드, 리다이렉션, 쿠키 설정과 같은 정보를 전달할 수 있게 해줍니다.
// Location: 을 넣으면 리다이렉션합니다.
header('Location: PAGENAME.EXTENTION')


// 변수를 제거하거나 세션 변수와 같은 메모리 내 특정 데이터를 해제하는 데 사용됩니다.
// 변수를 제거하여 더 이상 사용할 수 없도록 합니다.
function unset($var, ...$vars): void
```


## Source Code
```php

Signin.php
<?php
session_start();
include('config.php');

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $username = mysqli_real_escape_string($conn, $_POST['username']);
    $password = mysqli_real_escape_string($conn, $_POST['password']);

    $query = "SELECT * FROM users WHERE username = '$username'";
    $result = mysqli_query($conn, $query);
    $user = mysqli_fetch_assoc($result);

    if ($user && password_verify($password, $user['password'])) {
        $_SESSION['username'] = $username;
        header('Location: signin.php');
    } else {
        echo "<script>alert('Incorrect username or password'); window.location.href='login.php';</script>";
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head></head>
<body>
    <form method="POST" action="login.php">
        <label>Username</label>
        <input type="text" name="username" required>

        <label>Password</label>
        <input type="password" name="password" required>

        <button type="submit">Sign</button>
    </form>
</body>
</html>
```

Signup.php
```php
<?php
session_start();
include('config.php');

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $username = mysqli_real_escape_string($conn, $_POST['username']);
    $email = mysqli_real_escape_string($conn, $_POST['email']);
    $password = mysqli_real_escape_string($conn, $_POST['password']);
    $hashed_password = password_hash($password, PASSWORD_BCRYPT);

    $query = "INSERT INTO users (username, email, password) VALUES ('$username', '$email', '$hashed_password')";

    if (mysqli_query($conn, $query)) {
        echo "<script>alert('Account created successfully'); window.location.href='login.php';</script>";
    } else {
        echo "<script>alert('Error: Unable to create account'); window.location.href='signup.php';</script>";
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head></head>
<body>
    <form method="POST" action="signup.php">
        <label>Username</label>
        <input type="text" name="username" required>

        <label>Email</label>
        <input type="email" name="email" required>

        <label>Password</label>
        <input type="password" name="password" required>

        <button type="submit">Sign Up</button>
    </form>
</body>
</html>
```
main.php
```php
<?php
session_start();

if (!isset($_SESSION['username'])) {
    header('Location: login.php');
    exit();
}
?>

<!DOCTYPE html>
<html lang="en">
<head></head>
<body>
    <h1>Welcome, <?php echo $_SESSION['username']; ?>!</h1>
    <a href="logout.php">Logout</a>
</body>
</html>
```

Signout.php
```php
<?php
// logout.php
session_start();
if (isset($_SESSION['username'])) {
    unset($_SESSION['username']);
}
session_destroy();
header('Location: login.php');
exit();
?>
```
config.php
```php
<?php
$servername = "localhost";
$username = "root";
$password = "";
$dbname = "mydatabase";

$conn = mysqli_connect($servername, $username, $password, $dbname);

if (!$conn) {
    die("Connection failed: " . mysqli_connect_error());
}
?>
```
